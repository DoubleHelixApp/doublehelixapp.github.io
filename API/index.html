
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://doublehelix.app/API/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../advanced-topics/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>API - Documentation for DoubleHelix</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Documentation for DoubleHelix" class="md-header__button md-logo" aria-label="Documentation for DoubleHelix" data-md-component="logo">
      
  <img src="../logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation for DoubleHelix
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/DoubleHelixApp/DoubleHelix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentation for DoubleHelix" class="md-nav__button md-logo" aria-label="Documentation for DoubleHelix" data-md-component="logo">
      
  <img src="../logo.jpg" alt="logo">

    </a>
    Documentation for DoubleHelix
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DoubleHelixApp/DoubleHelix" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to DoubleHelix
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unitprefix-class" class="md-nav__link">
    <span class="md-ellipsis">
      UnitPrefix class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix" class="md-nav__link">
    <span class="md-ellipsis">
      UnitPrefix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix.convert_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      convert_bytes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller" class="md-nav__link">
    <span class="md-ellipsis">
      VariantCaller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.call" class="md-nav__link">
    <span class="md-ellipsis">
      call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.kill" class="md-nav__link">
    <span class="md-ellipsis">
      kill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.files.file_type_checker.FileTypeChecker" class="md-nav__link">
    <span class="md-ellipsis">
      FileTypeChecker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.files.file_type_checker.FileTypeChecker.get_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.naming.converter.Converter" class="md-nav__link">
    <span class="md-ellipsis">
      Converter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.naming.converter.Converter.canonicalize" class="md-nav__link">
    <span class="md-ellipsis">
      canonicalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.reference.Reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository" class="md-nav__link">
    <span class="md-ellipsis">
      Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository.acquire" class="md-nav__link">
    <span class="md-ellipsis">
      acquire
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository.ingest" class="md-nav__link">
    <span class="md-ellipsis">
      ingest
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-topics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced topics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data folder
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User guide
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unitprefix-class" class="md-nav__link">
    <span class="md-ellipsis">
      UnitPrefix class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix" class="md-nav__link">
    <span class="md-ellipsis">
      UnitPrefix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix.convert" class="md-nav__link">
    <span class="md-ellipsis">
      convert
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.utility.unit_prefix.UnitPrefix.convert_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      convert_bytes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller" class="md-nav__link">
    <span class="md-ellipsis">
      VariantCaller
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.call" class="md-nav__link">
    <span class="md-ellipsis">
      call
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.kill" class="md-nav__link">
    <span class="md-ellipsis">
      kill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.alignment_map.variant_caller.VariantCaller.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.files.file_type_checker.FileTypeChecker" class="md-nav__link">
    <span class="md-ellipsis">
      FileTypeChecker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.files.file_type_checker.FileTypeChecker.get_type" class="md-nav__link">
    <span class="md-ellipsis">
      get_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.naming.converter.Converter" class="md-nav__link">
    <span class="md-ellipsis">
      Converter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.naming.converter.Converter.canonicalize" class="md-nav__link">
    <span class="md-ellipsis">
      canonicalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.reference.Reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository" class="md-nav__link">
    <span class="md-ellipsis">
      Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository.acquire" class="md-nav__link">
    <span class="md-ellipsis">
      acquire
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helix.reference.repository.Repository.ingest" class="md-nav__link">
    <span class="md-ellipsis">
      ingest
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api">API</h1>
<h2 id="unitprefix-class">UnitPrefix class</h2>


<div class="doc doc-object doc-class">



<a id="helix.utility.unit_prefix.UnitPrefix"></a>
    <div class="doc doc-contents first">


      <p>Convert a quantity into a more readable form using unit prefixes.</p>
<p>This class is expecially useful for very big or very small number, that
are difficult to read or visualize.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">UnitPrefix</span><span class="o">.</span><span class="n">convert_bytes</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="go">&#39;1 kB&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">UnitPrefix</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="go">&#39;1 k&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">UnitPrefix</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="go">&#39;10 m&#39;</span>
</code></pre></div>

              <details class="quote">
                <summary>Source code in <code>helix\utility\unit_prefix.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UnitPrefix</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a quantity into a more readable form using unit prefixes.</span>

<span class="sd">    This class is expecially useful for very big or very small number, that</span>
<span class="sd">    are difficult to read or visualize.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; UnitPrefix.convert_bytes(1024)</span>
<span class="sd">        &#39;1 kB&#39;</span>
<span class="sd">        &gt;&gt;&gt; UnitPrefix.convert(1000)</span>
<span class="sd">        &#39;1 k&#39;</span>
<span class="sd">        &gt;&gt;&gt; UnitPrefix.convert(0.01)</span>
<span class="sd">        &#39;10 m&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">convert_bytes</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bytes using binary prefixes.</span>

<span class="sd">        Args:</span>
<span class="sd">            input (int): The number to convert.</span>
<span class="sd">            decimal (int, optional): Number of decimals to use. Defaults to 2.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: The input number is a float</span>
<span class="sd">            ValueError: The input number is negative.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Converted number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert a fractional number of bytes&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert a negative number of bytes&quot;</span><span class="p">)</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">si_prefixes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot; B&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot; kB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot; MB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot; GB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot; TB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">40</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0 B&quot;</span>

        <span class="n">input_log</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">input_log</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">input_log</span><span class="p">))</span>

        <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">si_prefixes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">min_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">max_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">max_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span>
            <span class="k">elif</span> <span class="n">min_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span> <span class="ow">and</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>

            <span class="k">if</span> <span class="n">in_interval</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="nb">input</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="c1"># Not interested in any .0000 at the end</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="c1"># If converted == &quot;0&quot; will become &quot;&quot;</span>
                <span class="k">if</span> <span class="n">converted</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
                <span class="n">converted</span> <span class="o">+=</span> <span class="n">letter</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">converted</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a quantity using metric prefixes.</span>

<span class="sd">        Args:</span>
<span class="sd">            input (int): The number to convert.</span>
<span class="sd">            decimal (int, optional): Number of decimals to use. Defaults to 2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Converted number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">si_prefixes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;0&quot;</span>

        <span class="n">input_log</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">input_log</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">input_log</span><span class="p">))</span>

        <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">si_prefixes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">min_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">max_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">max_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span>
            <span class="k">elif</span> <span class="n">min_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span> <span class="ow">and</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>

            <span class="k">if</span> <span class="n">in_interval</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="nb">input</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="o">**</span><span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="c1"># Not interested in any .0000 at the end</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="c1"># If converted == &quot;0&quot; will become &quot;&quot;</span>
                <span class="k">if</span> <span class="n">converted</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
                <span class="n">converted</span> <span class="o">+=</span> <span class="n">letter</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">converted</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="helix.utility.unit_prefix.UnitPrefix.convert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert a quantity using metric prefixes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>decimal</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of decimals to use. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Converted number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\utility\unit_prefix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a quantity using metric prefixes.</span>

<span class="sd">    Args:</span>
<span class="sd">        input (int): The number to convert.</span>
<span class="sd">        decimal (int, optional): Number of decimals to use. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Converted number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">si_prefixes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;μ&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>

    <span class="n">input_log</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">input_log</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">input_log</span><span class="p">))</span>

    <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">si_prefixes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">min_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">in_interval</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">max_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span>
        <span class="k">elif</span> <span class="n">min_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span> <span class="ow">and</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>

        <span class="k">if</span> <span class="n">in_interval</span><span class="p">:</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="nb">input</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="o">**</span><span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Not interested in any .0000 at the end</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="c1"># If converted == &quot;0&quot; will become &quot;&quot;</span>
            <span class="k">if</span> <span class="n">converted</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="n">converted</span> <span class="o">+=</span> <span class="n">letter</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">converted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="helix.utility.unit_prefix.UnitPrefix.convert_bytes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_bytes</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert bytes using binary prefixes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>decimal</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of decimals to use. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input number is a float</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input number is negative.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Converted number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\utility\unit_prefix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_bytes</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert bytes using binary prefixes.</span>

<span class="sd">    Args:</span>
<span class="sd">        input (int): The number to convert.</span>
<span class="sd">        decimal (int, optional): Number of decimals to use. Defaults to 2.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: The input number is a float</span>
<span class="sd">        ValueError: The input number is negative.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Converted number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert a fractional number of bytes&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert a negative number of bytes&quot;</span><span class="p">)</span>
    <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">si_prefixes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot; B&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot; kB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot; MB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot; GB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot; TB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">40</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;0 B&quot;</span>

    <span class="n">input_log</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">input_log</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">input_log</span><span class="p">))</span>

    <span class="n">converted</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">si_prefixes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">min_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">in_interval</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">max_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span>
        <span class="k">elif</span> <span class="n">min_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_interval</span> <span class="o">=</span> <span class="n">input_log</span> <span class="o">&gt;=</span> <span class="n">min_interval</span> <span class="ow">and</span> <span class="n">input_log</span> <span class="o">&lt;</span> <span class="n">max_interval</span>

        <span class="k">if</span> <span class="n">in_interval</span><span class="p">:</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="nb">input</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="o">**</span><span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Not interested in any .0000 at the end</span>
            <span class="n">converted</span> <span class="o">=</span> <span class="n">converted</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="c1"># If converted == &quot;0&quot; will become &quot;&quot;</span>
            <span class="k">if</span> <span class="n">converted</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">converted</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="n">converted</span> <span class="o">+=</span> <span class="n">letter</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">converted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="helix.alignment_map.variant_caller.VariantCaller"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="helix.progress.simple_worker.SimpleWorker">SimpleWorker</span></code></p>


      <p>This class is responsible for calling variants in a given alignment file.</p>

              <details class="quote">
                <summary>Source code in <code>helix\alignment_map\variant_caller.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">VariantCaller</span><span class="p">(</span><span class="n">SimpleWorker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is responsible for calling variants in a given alignment file.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">AlignmentMapFile</span><span class="p">,</span>
        <span class="n">calling_type</span><span class="p">:</span> <span class="n">VariantCallingType</span> <span class="o">=</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">Both</span><span class="p">,</span>
        <span class="n">repo_config</span><span class="p">:</span> <span class="n">RepositoryConfig</span> <span class="o">=</span> <span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">REPOSITORY</span><span class="p">,</span>
        <span class="n">ext_config</span><span class="p">:</span> <span class="n">ExternalConfig</span> <span class="o">=</span> <span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">EXTERNAL</span><span class="p">,</span>
        <span class="n">external</span><span class="p">:</span> <span class="n">External</span> <span class="o">=</span> <span class="n">External</span><span class="p">(),</span>
        <span class="n">progress</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        Args:</span>
<span class="sd">            input (AlignmentMapFile):</span>
<span class="sd">                File that contains aligned reads.</span>
<span class="sd">            calling_type (VariantCallingType, optional):</span>
<span class="sd">                Type of variant calling to perform. Defaults to VariantCallingType.Both.</span>
<span class="sd">            repo_config (RepositoryConfig, optional):</span>
<span class="sd">                Configuration for reference genome repository. Defaults to</span>
<span class="sd">                MANAGER_CFG.REPOSITORY.</span>
<span class="sd">            ext_config (ExternalConfig, optional):</span>
<span class="sd">                Configuration for external tools. Defaults to MANAGER_CFG.EXTERNAL.</span>
<span class="sd">            external (External, optional):</span>
<span class="sd">                Object that contains functions to call external tools.</span>
<span class="sd">                Defaults to External().</span>
<span class="sd">            progress (Callable[[str, int], optional):</span>
<span class="sd">                Function that accept a status message and a percentage,</span>
<span class="sd">                for progress tracking. Defaults to None.</span>
<span class="sd">            logger (Logger, optional):</span>
<span class="sd">                Logger object. Defaults to logging.getLogger(__name__).</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError:</span>
<span class="sd">                If the index stats inside `input` are not available.</span>
<span class="sd">            RuntimeError:</span>
<span class="sd">                If the reference genome for `input` is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external</span> <span class="o">=</span> <span class="n">external</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span> <span class="o">=</span> <span class="n">ext_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ploidy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">repo_config</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;ploidy.txt&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">progress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span> <span class="o">=</span> <span class="nb">input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">=</span> <span class="n">calling_type</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">index_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Index stats cannot be None for variant calling&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Reference cannot be None for variant calling&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Does exactly what you think it does.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Equivalent of call().</span>

<span class="sd">        Needed to provide a run() method for the Thread interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span><span class="o">.</span><span class="n">fasta</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Calling variants with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span>

        <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">==</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">InDel</span><span class="p">:</span>
            <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;-V snps&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">==</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">SNP</span><span class="p">:</span>
            <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;-V indels&quot;</span>

        <span class="n">output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span>
        <span class="p">)</span>

        <span class="n">pileup_opt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;mpileup -B -I -C 50 --threads </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span><span class="o">.</span><span class="n">threads</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s1">&#39;-f &quot;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&quot; -Ou &quot;</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="p">)</span>
        <span class="n">call_opt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;call --ploidy-file &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ploidy</span><span class="si">}</span><span class="s1">&quot; </span><span class="si">{</span><span class="n">skip_variant_opt</span><span class="si">}</span><span class="s1"> -mv&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;-P 0 --threads </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span><span class="o">.</span><span class="n">threads</span><span class="si">}</span><span class="s1"> -Oz -o &quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="p">)</span>
        <span class="n">tabix_opt</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;-p vcf &quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

        <span class="n">pileup_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pileup_opt</span><span class="p">)</span>
        <span class="n">call_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">call_opt</span><span class="p">)</span>
        <span class="n">tabix_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tabix_opt</span><span class="p">)</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mapped_sequences</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span><span class="o">.</span><span class="n">mapped</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">index_stats</span>
            <span class="p">]</span>
            <span class="n">mapped_sequences</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mapped_sequences</span><span class="p">)</span>

            <span class="c1"># 112 bytes seems to be the average bytes written for a single base</span>
            <span class="n">total_bytes</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">mapped_sequences</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">alignment_stats</span><span class="o">.</span><span class="n">average_length</span>
                <span class="o">*</span> <span class="mi">112</span>
            <span class="p">)</span>

            <span class="n">progress</span> <span class="o">=</span> <span class="n">BaseProgressCalculator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">,</span> <span class="n">total_bytes</span><span class="p">,</span> <span class="s2">&quot;[1/2] Calling&quot;</span>
            <span class="p">)</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">compute_on_write_bytes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">bcftools</span><span class="p">(</span>
            <span class="n">pileup_opt</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">io</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">bcftools</span><span class="p">(</span><span class="n">call_opt</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">call</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="n">BaseProgressCalculator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">,</span> <span class="n">output_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span> <span class="s2">&quot;[2/2] Indexing&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">tabix</span><span class="p">(</span>
            <span class="n">tabix_opt</span><span class="p">,</span> <span class="n">io</span><span class="o">=</span><span class="n">progress</span><span class="o">.</span><span class="n">compute_on_read_bytes</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Kill a variant calling operation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># The while is just to prevent a (unlikely IMO but who knows) situation</span>
            <span class="c1"># where _is_quitting is seen as False by the other thread after Popen.kill()</span>
            <span class="c1"># has been called.</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">operation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">operation</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed 10 attempts to kill </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while killing variant calling: </span><span class="si">{</span><span class="n">e</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="helix.alignment_map.variant_caller.VariantCaller.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">calling_type</span><span class="o">=</span><span class="n">VariantCallingType</span><span class="o">.</span><span class="n">Both</span><span class="p">,</span> <span class="n">repo_config</span><span class="o">=</span><span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">REPOSITORY</span><span class="p">,</span> <span class="n">ext_config</span><span class="o">=</span><span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">EXTERNAL</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="n">External</span><span class="p">(),</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Initialize the class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input</code></td>
            <td>
                  <code><span title="helix.alignment_map.alignment_map_file.AlignmentMapFile">AlignmentMapFile</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File that contains aligned reads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>calling_type</code></td>
            <td>
                  <code><span title="helix.alignment_map.variant_caller.VariantCallingType">VariantCallingType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of variant calling to perform. Defaults to VariantCallingType.Both.</p>
              </div>
            </td>
            <td>
                  <code><span title="helix.alignment_map.variant_caller.VariantCallingType.Both">Both</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>repo_config</code></td>
            <td>
                  <code><span title="helix.configuration.RepositoryConfig">RepositoryConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for reference genome repository. Defaults to
MANAGER_CFG.REPOSITORY.</p>
              </div>
            </td>
            <td>
                  <code><span title="helix.configuration.MANAGER_CFG.REPOSITORY">REPOSITORY</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ext_config</code></td>
            <td>
                  <code><span title="helix.configuration.ExternalConfig">ExternalConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for external tools. Defaults to MANAGER_CFG.EXTERNAL.</p>
              </div>
            </td>
            <td>
                  <code><span title="helix.configuration.MANAGER_CFG.EXTERNAL">EXTERNAL</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>external</code></td>
            <td>
                  <code><span title="helix.utility.external.External">External</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object that contains functions to call external tools.
Defaults to External().</p>
              </div>
            </td>
            <td>
                  <code><span title="helix.utility.external.External">External</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>progress</code></td>
            <td>
                  <code>Callable[[str, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that accept a status message and a percentage,
for progress tracking. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>logger</code></td>
            <td>
                  <code>Logger</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger object. Defaults to logging.getLogger(<strong>name</strong>).</p>
              </div>
            </td>
            <td>
                  <code><span title="logging.getLogger">getLogger</span>(__name__)</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the index stats inside <code>input</code> are not available.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the reference genome for <code>input</code> is not available.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\alignment_map\variant_caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="nb">input</span><span class="p">:</span> <span class="n">AlignmentMapFile</span><span class="p">,</span>
    <span class="n">calling_type</span><span class="p">:</span> <span class="n">VariantCallingType</span> <span class="o">=</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">Both</span><span class="p">,</span>
    <span class="n">repo_config</span><span class="p">:</span> <span class="n">RepositoryConfig</span> <span class="o">=</span> <span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">REPOSITORY</span><span class="p">,</span>
    <span class="n">ext_config</span><span class="p">:</span> <span class="n">ExternalConfig</span> <span class="o">=</span> <span class="n">MANAGER_CFG</span><span class="o">.</span><span class="n">EXTERNAL</span><span class="p">,</span>
    <span class="n">external</span><span class="p">:</span> <span class="n">External</span> <span class="o">=</span> <span class="n">External</span><span class="p">(),</span>
    <span class="n">progress</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">    Args:</span>
<span class="sd">        input (AlignmentMapFile):</span>
<span class="sd">            File that contains aligned reads.</span>
<span class="sd">        calling_type (VariantCallingType, optional):</span>
<span class="sd">            Type of variant calling to perform. Defaults to VariantCallingType.Both.</span>
<span class="sd">        repo_config (RepositoryConfig, optional):</span>
<span class="sd">            Configuration for reference genome repository. Defaults to</span>
<span class="sd">            MANAGER_CFG.REPOSITORY.</span>
<span class="sd">        ext_config (ExternalConfig, optional):</span>
<span class="sd">            Configuration for external tools. Defaults to MANAGER_CFG.EXTERNAL.</span>
<span class="sd">        external (External, optional):</span>
<span class="sd">            Object that contains functions to call external tools.</span>
<span class="sd">            Defaults to External().</span>
<span class="sd">        progress (Callable[[str, int], optional):</span>
<span class="sd">            Function that accept a status message and a percentage,</span>
<span class="sd">            for progress tracking. Defaults to None.</span>
<span class="sd">        logger (Logger, optional):</span>
<span class="sd">            Logger object. Defaults to logging.getLogger(__name__).</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            If the index stats inside `input` are not available.</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            If the reference genome for `input` is not available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_external</span> <span class="o">=</span> <span class="n">external</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span> <span class="o">=</span> <span class="n">ext_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ploidy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">repo_config</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;ploidy.txt&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">progress</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span> <span class="o">=</span> <span class="nb">input</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">=</span> <span class="n">calling_type</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">index_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Index stats cannot be None for variant calling&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Reference cannot be None for variant calling&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="helix.alignment_map.variant_caller.VariantCaller.call" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">call</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Does exactly what you think it does.</p>

            <details class="quote">
              <summary>Source code in <code>helix\alignment_map\variant_caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Does exactly what you think it does.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="helix.alignment_map.variant_caller.VariantCaller.kill" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kill</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Kill a variant calling operation.</p>

            <details class="quote">
              <summary>Source code in <code>helix\alignment_map\variant_caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Kill a variant calling operation.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># The while is just to prevent a (unlikely IMO but who knows) situation</span>
        <span class="c1"># where _is_quitting is seen as False by the other thread after Popen.kill()</span>
        <span class="c1"># has been called.</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">operation</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed 10 attempts to kill </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while killing variant calling: </span><span class="si">{</span><span class="n">e</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="helix.alignment_map.variant_caller.VariantCaller.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Equivalent of call().</p>
<p>Needed to provide a run() method for the Thread interface.</p>

            <details class="quote">
              <summary>Source code in <code>helix\alignment_map\variant_caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Equivalent of call().</span>

<span class="sd">    Needed to provide a run() method for the Thread interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span><span class="o">.</span><span class="n">fasta</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Calling variants with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">reference_genome</span><span class="o">.</span><span class="n">ready_reference</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span>

    <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">==</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">InDel</span><span class="p">:</span>
        <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;-V snps&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span> <span class="o">==</span> <span class="n">VariantCallingType</span><span class="o">.</span><span class="n">SNP</span><span class="p">:</span>
        <span class="n">skip_variant_opt</span> <span class="o">=</span> <span class="s2">&quot;-V indels&quot;</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_file</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_calling_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.vcf.gz&quot;</span>
    <span class="p">)</span>

    <span class="n">pileup_opt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;mpileup -B -I -C 50 --threads </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span><span class="o">.</span><span class="n">threads</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s1">&#39;-f &quot;</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&quot; -Ou &quot;</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="p">)</span>
    <span class="n">call_opt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;call --ploidy-file &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ploidy</span><span class="si">}</span><span class="s1">&quot; </span><span class="si">{</span><span class="n">skip_variant_opt</span><span class="si">}</span><span class="s1"> -mv&#39;</span>
        <span class="sa">f</span><span class="s1">&#39;-P 0 --threads </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ext_config</span><span class="o">.</span><span class="n">threads</span><span class="si">}</span><span class="s1"> -Oz -o &quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="p">)</span>
    <span class="n">tabix_opt</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;-p vcf &quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

    <span class="n">pileup_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pileup_opt</span><span class="p">)</span>
    <span class="n">call_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">call_opt</span><span class="p">)</span>
    <span class="n">tabix_opt</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tabix_opt</span><span class="p">)</span>

    <span class="n">progress</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mapped_sequences</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span><span class="o">.</span><span class="n">mapped</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">index_stats</span>
        <span class="p">]</span>
        <span class="n">mapped_sequences</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mapped_sequences</span><span class="p">)</span>

        <span class="c1"># 112 bytes seems to be the average bytes written for a single base</span>
        <span class="n">total_bytes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">mapped_sequences</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_file</span><span class="o">.</span><span class="n">file_info</span><span class="o">.</span><span class="n">alignment_stats</span><span class="o">.</span><span class="n">average_length</span>
            <span class="o">*</span> <span class="mi">112</span>
        <span class="p">)</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="n">BaseProgressCalculator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">,</span> <span class="n">total_bytes</span><span class="p">,</span> <span class="s2">&quot;[1/2] Calling&quot;</span>
        <span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">compute_on_write_bytes</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">bcftools</span><span class="p">(</span>
        <span class="n">pileup_opt</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">io</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">bcftools</span><span class="p">(</span><span class="n">call_opt</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">call</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_quitting</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span>

    <span class="n">progress</span> <span class="o">=</span> <span class="n">BaseProgressCalculator</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">,</span> <span class="n">output_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span> <span class="s2">&quot;[2/2] Indexing&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">tabix</span><span class="p">(</span>
        <span class="n">tabix_opt</span><span class="p">,</span> <span class="n">io</span><span class="o">=</span><span class="n">progress</span><span class="o">.</span><span class="n">compute_on_read_bytes</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_operation</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_quitting_ack</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="helix.files.file_type_checker.FileTypeChecker"></a>
    <div class="doc doc-contents first">


              <details class="quote">
                <summary>Source code in <code>helix\files\file_type_checker.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FileTypeChecker</span><span class="p">:</span>

    <span class="n">_EXT_TO_TYPE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.7z&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">SEVENZIP</span><span class="p">,</span>
        <span class="s2">&quot;.zip&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">ZIP</span><span class="p">,</span>
        <span class="s2">&quot;.bz2&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">BZIP</span><span class="p">,</span>
        <span class="s2">&quot;.bz&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">BZIP</span><span class="p">,</span>
        <span class="s2">&quot;.gz&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">RAZF_GZIP</span><span class="p">,</span>
        <span class="s2">&quot;.fa&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">DECOMPRESSED</span><span class="p">,</span>
        <span class="s2">&quot;.fasta&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">DECOMPRESSED</span><span class="p">,</span>
        <span class="s2">&quot;.fna&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">DECOMPRESSED</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_TYPE_TO_EXT</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">SEVENZIP</span><span class="p">:</span> <span class="s2">&quot;.7z&quot;</span><span class="p">,</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span> <span class="s2">&quot;.zip&quot;</span><span class="p">,</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">BZIP</span><span class="p">:</span> <span class="s2">&quot;.bz2&quot;</span><span class="p">,</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">RAZF_GZIP</span><span class="p">:</span> <span class="s2">&quot;.fa.gz&quot;</span><span class="p">,</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">GZIP</span><span class="p">:</span> <span class="s2">&quot;.fa.gz&quot;</span><span class="p">,</span>
        <span class="n">FileType</span><span class="o">.</span><span class="n">DECOMPRESSED</span><span class="p">:</span> <span class="s2">&quot;.fa&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_HTSFILE_TO_TYPE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;BGZF&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">BGZIP</span><span class="p">,</span>
        <span class="s2">&quot;gzip&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">RAZF_GZIP</span><span class="p">,</span>
        <span class="s2">&quot;RAZF&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">RAZF_GZIP</span><span class="p">,</span>
        <span class="s2">&quot;FASTA&quot;</span><span class="p">:</span> <span class="n">FileType</span><span class="o">.</span><span class="n">DECOMPRESSED</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external</span><span class="p">:</span> <span class="n">External</span> <span class="o">=</span> <span class="n">External</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external</span> <span class="o">=</span> <span class="n">external</span>

    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Type starting from a file path.</span>

<span class="sd">        Args:</span>
<span class="sd">            file (Path): Path of the file to analyze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Type | None: Type or None if the type is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extensions can be wrong or misleading; Use htsfile and</span>
        <span class="c1"># eventually fallback on extension.</span>

        <span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">htsfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_HTSFILE_TO_TYPE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_type</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>

        <span class="c1"># TODO: starting from .gz in _EXT_TO_TYPE, htsfile should really</span>
        <span class="c1"># be able to give something useful. If it isn&#39;t the case, it could</span>
        <span class="c1"># mean the file is corrupted. Unsure what&#39;s the best logic here.</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_EXT_TO_TYPE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_EXT_TO_TYPE</span><span class="p">[</span><span class="n">extension</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_EXT_TO_TYPE</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">type</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="helix.files.file_type_checker.FileTypeChecker.get_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_type</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Get a Type starting from a file path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path of the file to analyze.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="helix.files.file_type_checker.FileType">FileType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type | None: Type or None if the type is unknown.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\files\file_type_checker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a Type starting from a file path.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): Path of the file to analyze.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Type | None: Type or None if the type is unknown.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extensions can be wrong or misleading; Use htsfile and</span>
    <span class="c1"># eventually fallback on extension.</span>

    <span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external</span><span class="o">.</span><span class="n">htsfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_HTSFILE_TO_TYPE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">file_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># TODO: starting from .gz in _EXT_TO_TYPE, htsfile should really</span>
    <span class="c1"># be able to give something useful. If it isn&#39;t the case, it could</span>
    <span class="c1"># mean the file is corrupted. Unsure what&#39;s the best logic here.</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_EXT_TO_TYPE</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FileTypeChecker</span><span class="o">.</span><span class="n">_EXT_TO_TYPE</span><span class="p">[</span><span class="n">extension</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="helix.naming.converter.Converter"></a>
    <div class="doc doc-contents first">


              <details class="quote">
                <summary>Source code in <code>helix\naming\converter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Converter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">canonicalize</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a sequence name into a &quot;canonical&quot; form,</span>
<span class="sd">        which is essentially the Number format:</span>
<span class="sd">        - Digits only for autosome</span>
<span class="sd">        - X/Y for sexual</span>
<span class="sd">        - M for mitochondrial</span>
<span class="sd">        - Other sequences are not touched</span>

<span class="sd">        Args:</span>
<span class="sd">            sequence_name (str): Sequence to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Converted name sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">,</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SequenceType</span><span class="p">:</span>
        <span class="n">canonical_name</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="n">canonicalize</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">canonical_name</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">Autosome</span>
        <span class="k">elif</span> <span class="n">canonical_name</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">X</span>
        <span class="k">elif</span> <span class="n">canonical_name</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">Y</span>
        <span class="k">elif</span> <span class="n">canonical_name</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">Mitochondrial</span>
        <span class="k">elif</span> <span class="n">canonical_name</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">Unmapped</span>
        <span class="k">return</span> <span class="n">SequenceType</span><span class="o">.</span><span class="n">Other</span>

    <span class="k">def</span> <span class="nf">_find_in_table</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="nb">input</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">normalized</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">normalized</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">ChromosomeNameType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Chr to Number (e.g., chr1 -&gt; 1; chrMT-&gt;MT)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">normalized</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CHR&quot;</span><span class="p">):</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;CHR&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># MT-&gt;M. This accounts also for the translation chrMT -&gt; M,</span>
        <span class="c1"># since it&#39;s executed after the previous if.</span>
        <span class="k">if</span> <span class="n">normalized</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MT&quot;</span><span class="p">):</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MT&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1">#  Accession to Number (e.g., NC_000001 -&gt; 1)</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NC_&quot;</span><span class="p">):</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="n">_find_in_table</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">REFSEQ_TO_NUMBER</span><span class="p">)</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="n">_find_in_table</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">REFSEQ_T2T_TO_NUMBER</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CM&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">):</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="n">_find_in_table</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">GENBANK_TO_NUMBER</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CP&quot;</span><span class="p">):</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">Converter</span><span class="o">.</span><span class="n">_find_in_table</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">GENBANK_T2T_TO_NUMBER</span><span class="p">)</span>

        <span class="c1"># Convert from Number format to target</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">Chr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">normalized</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="ow">or</span> <span class="n">normalized</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="s2">&quot;chr&quot;</span> <span class="o">+</span> <span class="n">normalized</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">normalized</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">Number</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">normalized</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">GenBank</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NUMBER_TO_GENBANK</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">RefSeq</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NUMBER_TO_REFSEQ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">RefSeqT2T</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NUMBER_TO_REFSEQ_T2T</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">GenBankT2T</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NUMBER_TO_GENBANK_T2T</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting to unrecognized target format: </span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="helix.naming.converter.Converter.canonicalize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">canonicalize</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert a sequence name into a "canonical" form,
which is essentially the Number format:
- Digits only for autosome
- X/Y for sexual
- M for mitochondrial
- Other sequences are not touched</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>sequence_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Converted name sequence.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\naming\converter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">canonicalize</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a sequence name into a &quot;canonical&quot; form,</span>
<span class="sd">    which is essentially the Number format:</span>
<span class="sd">    - Digits only for autosome</span>
<span class="sd">    - X/Y for sexual</span>
<span class="sd">    - M for mitochondrial</span>
<span class="sd">    - Other sequences are not touched</span>

<span class="sd">    Args:</span>
<span class="sd">        sequence_name (str): Sequence to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Converted name sequence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">sequence_name</span><span class="p">,</span> <span class="n">ChromosomeNameType</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="helix.reference.reference.Reference"></a>
    <div class="doc doc-contents first">


      <p>This class represent a reference genome.</p>

              <details class="quote">
                <summary>Source code in <code>helix\reference\reference.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Reference</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represent a reference genome.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reference_map</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]],</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span> <span class="o">=</span> <span class="n">reference_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_genome_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_by_genome</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matching</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Genome</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_matching_genomes</span><span class="p">()</span>
        <span class="nb">sorted</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genome_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
        <span class="nb">sorted</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
                <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genome_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matching</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">build</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">sorted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Likely </span><span class="si">{</span><span class="nb">sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Found more than one valid builds for the reference of the file. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;This is likely an issue with the reference genome metadata. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Please open a bug report.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready_reference</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ready_reference</span> <span class="o">=</span> <span class="n">match</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ReferenceStatus</span><span class="o">.</span><span class="n">Available</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matching</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ReferenceStatus</span><span class="o">.</span><span class="n">Downloadable</span>
        <span class="c1"># There&#39;s a possibility to build it only if every sequence has a</span>
        <span class="c1"># match in the metadata.</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ReferenceStatus</span><span class="o">.</span><span class="n">Buildable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ReferenceStatus</span><span class="o">.</span><span class="n">Unknown</span>

    <span class="k">def</span> <span class="nf">_md5_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if MD5 is available for every input sequence.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if MD5 available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">md5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">_index_by_genome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Genome</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For every genome that has at least one match in the input sequence,</span>
<span class="sd">        return a map between its sequences and input sequences.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Genome, dict[Sequence, Sequence]]: Map Genome &lt;-&gt; Sequences.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parents</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Genome</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">parent</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span>
        <span class="p">)</span>
        <span class="n">genome_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">sequences</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="n">genome_map</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">sequences</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">query_sequence</span><span class="p">,</span> <span class="n">match_sequences</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">match_sequences</span><span class="p">:</span>
                        <span class="n">genome_map</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">sequence</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_sequence</span>
                        <span class="k">break</span>
            <span class="k">for</span> <span class="n">query_sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query_sequence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">genome_map</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">genome_map</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query_sequence</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">genome_map</span>

    <span class="k">def</span> <span class="nf">_get_matching_genomes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of genomes that are guaranteed to match the input sequence</span>
<span class="sd">        by name, length or MD5 (if available in the input sequence).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[Genome]: list of matching genomes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">match_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># None is a special key for all the sequences</span>
        <span class="c1"># that have 0 matches among all the known references.</span>
        <span class="c1"># If None is in _genome_map means we didn&#39;t find a</span>
        <span class="c1"># reference.</span>
        <span class="k">for</span> <span class="n">genome</span><span class="p">,</span> <span class="n">matches</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genome_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">matching</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">genome_sequence</span><span class="p">,</span> <span class="n">query_sequence</span> <span class="ow">in</span> <span class="n">matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">genome_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">query_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">genome_sequence</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">query_sequence</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">query_sequence</span><span class="o">.</span><span class="n">md5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">genome_sequence</span><span class="o">.</span><span class="n">md5</span> <span class="o">!=</span> <span class="n">query_sequence</span><span class="o">.</span><span class="n">md5</span><span class="p">:</span>
                        <span class="n">matching</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">genome_sequence</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">query_sequence</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">matching</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">!s}</span><span class="s2"> is a perfect match.&quot;</span><span class="p">)</span>
                <span class="n">match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match_list</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="helix.reference.repository.Repository"></a>
    <div class="doc doc-contents first">


      <p>Manages the reference genomes and their metadata.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>repository = Repository()
repository.find(file.file_info.sequences)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
              <details class="quote">
                <summary>Source code in <code>helix\reference\repository.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Repository</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the reference genomes and their metadata.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; repository = Repository()</span>
<span class="sd">        &gt;&gt;&gt; repository.find(file.file_info.sequences)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">loader</span><span class="p">:</span> <span class="n">MetadataLoader</span> <span class="o">=</span> <span class="n">MetadataLoader</span><span class="p">(),</span>
        <span class="n">downloader</span><span class="p">:</span> <span class="n">Downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">(),</span>
        <span class="n">mtdna</span><span class="p">:</span> <span class="n">MtDNA</span> <span class="o">=</span> <span class="n">MtDNA</span><span class="p">(),</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">RepositoryConfig</span> <span class="o">=</span> <span class="n">RepositoryConfig</span><span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span> <span class="o">=</span> <span class="n">loader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="o">=</span> <span class="n">downloader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mtdna</span> <span class="o">=</span> <span class="n">mtdna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genomes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1"># Index individual sequences by their MD5 and length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_md5</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_sequences</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">md5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">genomes</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_length</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_sequences</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">genomes</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="k">def</span> <span class="nf">analyze_references</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Analyzing sequence by sequence</span>
        <span class="n">different_md5_same_length</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">length</span><span class="p">,</span> <span class="n">seqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_length</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">unique_seq_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">:</span>
                <span class="n">unique_seq_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">md5</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_seq_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">57227414</span><span class="p">:</span>
                <span class="n">different_md5_same_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_seq_set</span><span class="p">)</span><span class="si">}</span><span class="s2"> different MD5 for length </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Analyzing the whole genome, looking for identical length sequences</span>
        <span class="c1"># with different MD5 sequences</span>
        <span class="n">different_md5s_same_lengths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">genome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genomes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">seq_lengths</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span><span class="p">])</span>
            <span class="n">seq_md5</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">md5</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">seq_lengths</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">different_md5s_same_lengths</span><span class="p">:</span>
                <span class="n">different_md5s_same_lengths</span><span class="p">[</span><span class="n">seq_lengths</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">seq_md5</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">different_md5s_same_lengths</span><span class="p">[</span><span class="n">seq_lengths</span><span class="p">]]:</span>
                <span class="n">different_md5s_same_lengths</span><span class="p">[</span><span class="n">seq_lengths</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seq_md5</span><span class="p">,</span> <span class="n">genome</span><span class="p">))</span>

        <span class="n">ambiguous</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">different_md5s_same_lengths</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">ambiguous</span><span class="si">}</span><span class="s2"> possible ambiguous sequences of lengths:&quot;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">length</span><span class="p">,</span> <span class="n">md5s</span> <span class="ow">in</span> <span class="n">different_md5s_same_lengths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">md5s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">md5</span><span class="p">,</span> <span class="n">genome</span> <span class="ow">in</span> <span class="n">md5s</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequences</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]):</span>
        <span class="n">md5_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">md5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
        <span class="n">matching</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">md5_available</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">md5</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_md5</span><span class="p">:</span>
                    <span class="n">matching</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_md5</span><span class="p">[</span><span class="n">sequence</span><span class="o">.</span><span class="n">md5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">length</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_length</span><span class="p">:</span>
                    <span class="n">matching</span><span class="p">[</span><span class="n">sequence</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences_by_length</span><span class="p">[</span><span class="n">sequence</span><span class="o">.</span><span class="n">length</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Reference</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_group_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">genomes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Genome</span><span class="p">]):</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">genome</span> <span class="ow">in</span> <span class="n">genomes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span><span class="p">:</span>
                <span class="n">evaluated_criteria</span> <span class="o">=</span> <span class="n">criteria</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">evaluated_criteria</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
                    <span class="n">grouped</span><span class="p">[</span><span class="n">evaluated_criteria</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">evaluated_criteria</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grouped</span>

    <span class="k">def</span> <span class="nf">_get_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genome</span><span class="p">:</span> <span class="n">Genome</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">fai_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fai_url</span> <span class="o">=</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span> <span class="o">+</span> <span class="s2">&quot;.fai&quot;</span>
            <span class="n">fai_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">get_file_size</span><span class="p">(</span><span class="n">fai_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fai_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">genome</span><span class="o">.</span><span class="n">fai_url</span> <span class="o">=</span> <span class="n">fai_url</span>

        <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">gzi_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gzi_url</span> <span class="o">=</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span> <span class="o">+</span> <span class="s2">&quot;.gzi&quot;</span>
            <span class="n">gzi_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">get_file_size</span><span class="p">(</span><span class="n">gzi_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gzi_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">genome</span><span class="o">.</span><span class="n">gzi_url</span> <span class="o">=</span> <span class="n">gzi_url</span>

        <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">download_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">get_file_size</span><span class="p">(</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">genome</span><span class="o">.</span><span class="n">download_size</span> <span class="o">=</span> <span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unable to get the size of the fasta file for </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genome</span><span class="p">:</span> <span class="n">Genome</span><span class="p">):</span>
        <span class="n">dictionary</span><span class="p">:</span> <span class="n">AlignmentMapHeader</span> <span class="o">=</span> <span class="n">AlignmentMapHeader</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">genome</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>
        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">md5</span><span class="p">)</span>
            <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sequences</span>

    <span class="k">def</span> <span class="nf">_create_companion_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">genome</span><span class="p">:</span> <span class="n">Genome</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">samtools</span> <span class="o">=</span> <span class="n">Samtools</span><span class="p">()</span>
        <span class="n">bgzip</span> <span class="o">=</span> <span class="n">BGzip</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">: Starting post-download tasks.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">genome</span><span class="o">.</span><span class="n">gzi</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">: Generating bgzip index.&quot;</span><span class="p">)</span>
            <span class="n">bgzip</span><span class="o">.</span><span class="n">bgzip_wrapper</span><span class="p">(</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="p">,</span> <span class="n">genome</span><span class="o">.</span><span class="n">gzi</span><span class="p">,</span> <span class="n">BgzipAction</span><span class="o">.</span><span class="n">Reindex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">: bgzip index exists.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">genome</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">: Generating dictionary file.&quot;</span><span class="p">)</span>
            <span class="n">samtools</span><span class="o">.</span><span class="n">make_dictionary</span><span class="p">(</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="p">,</span> <span class="n">genome</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">: Dictionary file exists.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">reference</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genomes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">sequences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2"> as it has no sequences.&quot;</span><span class="p">)</span>
                    <span class="n">genome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingest</span><span class="p">(</span>
                        <span class="n">reference</span><span class="o">.</span><span class="n">fasta_url</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">reference</span><span class="o">.</span><span class="n">build</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">genomes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">genome</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genomes</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">genome</span><span class="p">:</span> <span class="n">Genome</span><span class="p">,</span> <span class="n">progress</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Genome</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This Python function downloads, and convert to BGZip format (if necessary) a reference</span>
<span class="sd">        genome.</span>

<span class="sd">        Args:</span>
<span class="sd">            genome (Genome): Genome to acquire</span>
<span class="sd">            progress (Callable[[str, int], None]): Callback function that takes two</span>
<span class="sd">                arguments: a string indicating the progress message and an integer</span>
<span class="sd">                indicating the progress percentage.</span>
<span class="sd">            force (bool): Determines whether to overwrite existing files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Genome: The reference genome.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">()</span>
        <span class="n">decompressor</span> <span class="o">=</span> <span class="n">Decompressor</span><span class="p">()</span>
        <span class="n">compressor</span> <span class="o">=</span> <span class="n">BGzip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exist. Re-using it.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_companion_files</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">genome</span>
        <span class="k">elif</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">bgzip_md5</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">downloaded_md5</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">decompressed_md5</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">bgzip_size</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">download_size</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">genome</span><span class="o">.</span><span class="n">decompressed_size</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Downloading from: </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">download_output</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
            <span class="n">genome</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[1/4] Downloading from: </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Decompressing: </span><span class="si">{</span><span class="n">download_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">decompressor_output</span> <span class="o">=</span> <span class="n">decompressor</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
            <span class="n">genome</span><span class="p">,</span>
            <span class="n">progress</span><span class="p">,</span>
            <span class="n">download_output</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;[2/4] Decompressing: </span><span class="si">{</span><span class="n">download_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start compressing to BGZip: </span><span class="si">{</span><span class="n">decompressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">compressor_output</span> <span class="o">=</span> <span class="n">compressor</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
            <span class="n">genome</span><span class="p">,</span>
            <span class="n">progress</span><span class="p">,</span>
            <span class="n">decompressor_output</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;[3/4] Compressing to BGZip: </span><span class="si">{</span><span class="n">decompressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating companion files: </span><span class="si">{</span><span class="n">compressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_companion_files</span><span class="p">(</span>
            <span class="n">genome</span><span class="p">,</span>
            <span class="n">force</span><span class="p">,</span>
            <span class="n">progress</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;[4/4] Creating companion files: </span><span class="si">{</span><span class="n">compressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">genome</span>

    <span class="k">def</span> <span class="nf">ingest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a genome to the repository.</span>

<span class="sd">        Build a new Genome object with the input parameters and call acquire() on it</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url for the FASTA file.</span>
<span class="sd">            source (str): Source of the Genome (i.e., &quot;Ensembl&quot;)</span>
<span class="sd">            build (str): Build of the Genome (i.e., &quot;38&quot;).</span>
<span class="sd">            force (bool, optional): True to force the ingestion even if the files exist.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Genome: Genome after ingestion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genome</span> <span class="o">=</span> <span class="n">Genome</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">)</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">genomes</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ingesting </span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">genome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sequences</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">genome</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="helix.reference.repository.Repository.acquire" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">acquire</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This Python function downloads, and convert to BGZip format (if necessary) a reference
genome.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>genome</code></td>
            <td>
                  <code><span title="helix.data.genome.Genome">Genome</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Genome to acquire</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>progress</code></td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[str, int], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callback function that takes two
arguments: a string indicating the progress message and an integer
indicating the progress percentage.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines whether to overwrite existing files.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Genome</code></td>            <td>
                  <code><span title="helix.data.genome.Genome">Genome</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The reference genome.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\reference\repository.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">genome</span><span class="p">:</span> <span class="n">Genome</span><span class="p">,</span> <span class="n">progress</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Genome</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Python function downloads, and convert to BGZip format (if necessary) a reference</span>
<span class="sd">    genome.</span>

<span class="sd">    Args:</span>
<span class="sd">        genome (Genome): Genome to acquire</span>
<span class="sd">        progress (Callable[[str, int], None]): Callback function that takes two</span>
<span class="sd">            arguments: a string indicating the progress message and an integer</span>
<span class="sd">            indicating the progress percentage.</span>
<span class="sd">        force (bool): Determines whether to overwrite existing files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Genome: The reference genome.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">()</span>
    <span class="n">decompressor</span> <span class="o">=</span> <span class="n">Decompressor</span><span class="p">()</span>
    <span class="n">compressor</span> <span class="o">=</span> <span class="n">BGzip</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exist. Re-using it.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_companion_files</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">genome</span>
    <span class="k">elif</span> <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">fasta</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">bgzip_md5</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">downloaded_md5</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">decompressed_md5</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">bgzip_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">download_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">genome</span><span class="o">.</span><span class="n">decompressed_size</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Downloading from: </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">download_output</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
        <span class="n">genome</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[1/4] Downloading from: </span><span class="si">{</span><span class="n">genome</span><span class="o">.</span><span class="n">fasta_url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Decompressing: </span><span class="si">{</span><span class="n">download_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">decompressor_output</span> <span class="o">=</span> <span class="n">decompressor</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
        <span class="n">genome</span><span class="p">,</span>
        <span class="n">progress</span><span class="p">,</span>
        <span class="n">download_output</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;[2/4] Decompressing: </span><span class="si">{</span><span class="n">download_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start compressing to BGZip: </span><span class="si">{</span><span class="n">decompressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">compressor_output</span> <span class="o">=</span> <span class="n">compressor</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span>
        <span class="n">genome</span><span class="p">,</span>
        <span class="n">progress</span><span class="p">,</span>
        <span class="n">decompressor_output</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;[3/4] Compressing to BGZip: </span><span class="si">{</span><span class="n">decompressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating companion files: </span><span class="si">{</span><span class="n">compressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_companion_files</span><span class="p">(</span>
        <span class="n">genome</span><span class="p">,</span>
        <span class="n">force</span><span class="p">,</span>
        <span class="n">progress</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;[4/4] Creating companion files: </span><span class="si">{</span><span class="n">compressor_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">genome</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="helix.reference.repository.Repository.ingest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ingest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Add a genome to the repository.</p>
<p>Build a new Genome object with the input parameters and call acquire() on it</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Url for the FASTA file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>source</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of the Genome (i.e., "Ensembl")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>build</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Build of the Genome (i.e., "38").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to force the ingestion even if the files exist.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Genome</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Genome after ingestion</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>helix\reference\repository.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ingest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a genome to the repository.</span>

<span class="sd">    Build a new Genome object with the input parameters and call acquire() on it</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): Url for the FASTA file.</span>
<span class="sd">        source (str): Source of the Genome (i.e., &quot;Ensembl&quot;)</span>
<span class="sd">        build (str): Build of the Genome (i.e., &quot;38&quot;).</span>
<span class="sd">        force (bool, optional): True to force the ingestion even if the files exist.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Genome: Genome after ingestion</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">genome</span> <span class="o">=</span> <span class="n">Genome</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">)</span>
    <span class="n">genome</span><span class="o">.</span><span class="n">parent_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">genomes</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ingesting </span><span class="si">{</span><span class="n">genome</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">genome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">genome</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
    <span class="n">genome</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sequences</span><span class="p">(</span><span class="n">genome</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">genome</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>